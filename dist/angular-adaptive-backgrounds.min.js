/*
  angular-adaptive-backgrounds v0.2.2
  http://brandly.github.io/angular-adaptive-backgrounds/
*/
(function(){angular.module("mb-adaptive-backgrounds",["ng"]).provider("adaptiveBackgroundsOptions",function(){!function(n){"use strict";var a=function(){return document.createElement("canvas").getContext("2d")},t=function(n,t){var e=new Image,r=n.src||n;"data:"!==r.substring(0,5)&&(e.crossOrigin="Anonymous"),e.onload=function(){var n=a("2d");n.drawImage(e,0,0);var r=n.getImageData(0,0,e.width,e.height);t&&t(r.data)},e.src=r},e=function(n){return["rgb(",n,")"].join("")},r=function(n){return n.map(function(n){return e(n.name)})},o=5,u=10,i={};i.colors=function(n,a){a=a||{};var i=a.exclude||[],c=a.paletteSize||u;t(n,function(t){for(var u=n.width*n.height||t.length,s={},l="",d=[],g={dominant:{name:"",count:0},palette:Array.apply(null,new Array(c)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},m=0;u>m;){if(d[0]=t[m],d[1]=t[m+1],d[2]=t[m+2],l=d.join(","),s[l]=l in s?s[l]+1:1,-1===i.indexOf(e(l))){var f=s[l];f>g.dominant.count?(g.dominant.name=l,g.dominant.count=f):g.palette.some(function(n){return f>n.count?(n.name=l,n.count=f,!0):void 0})}m+=4*o}if(a.success){var v=r(g.palette);a.success({dominant:e(g.dominant.name),secondary:v[0],palette:v})}})},n.RGBaster=n.RGBaster||i}(window);var n;return n={imageClass:null,exclude:["rgb(0,0,0)","rgba(255,255,255)"],lightClass:"ab-light-background",darkClass:"ab-dark-background"},{set:function(a){return angular.extend(n,a)},$get:function(){return n}}}).directive("adaptiveBackground",function(n,a){var t,e,r,o;return o=a,e=function(a){return n.getComputedStyle(a,null).getPropertyValue("background-image").replace("url(","").replace(")","")},t=/\d+/g,r=function(n){var a;return a=n.match(t),(299*a[0]+587*a[1]+114*a[2])/1e3},{restrict:"A",link:function(n,a,t){var u,i,c,s,l,d,g,m;return d=a[0],m=function(n){return"IMG"!==n.tagName},c=function(){var n,e;return e=t.abImageClass||o.imageClass,angular.element(null!=e&&(n=d.querySelector("."+e),null!=n)?n:a.find("img")[0])},g=function(t){var e;return a.css("backgroundColor",t.dominant),e=r(t.dominant),128>=e?(a.addClass(o.darkClass),a.removeClass(o.lightClass)):(a.addClass(o.lightClass),a.removeClass(o.darkClass)),t.backgroundYIQ=e,n.adaptiveBackgroundColors=t},u=function(n){return RGBaster.colors(n,{paletteSize:20,exclude:o.exclude,success:g})},i=c(),l=i[0],m(l)?u(e(l)):(s=function(){return l.src?u(l):void 0},i.on("load",s),n.$on("$destroy",function(){return i.off("load",s)}),s())}}})}).call(this);